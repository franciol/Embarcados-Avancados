
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://insper.github.io/Embarcados-Avancados/Tutorial-HPS-DeviceDriver1/">
      
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.7">
    
    
      
        <title>Device Driver - Eletiva: Embarcados Avan√ßados (SoC e Linux Embarcado)</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.19753c6b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.196e0c26.min.css">
        
          
          
          <meta name="theme-color" content="#ffffff">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../css/progress.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="white" data-md-color-accent="pink">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#device-driver" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://insper.github.io/Embarcados-Avancados/" title="Eletiva: Embarcados Avan√ßados (SoC e Linux Embarcado)" class="md-header-nav__button md-logo" aria-label="Eletiva: Embarcados Avan√ßados (SoC e Linux Embarcado)">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Eletiva: Embarcados Avan√ßados (SoC e Linux Embarcado)
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Device Driver
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/insper/Embarcados-Avancados/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Insper/Embarcados-Avancados
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://insper.github.io/Embarcados-Avancados/" title="Eletiva: Embarcados Avan√ßados (SoC e Linux Embarcado)" class="md-nav__button md-logo" aria-label="Eletiva: Embarcados Avan√ßados (SoC e Linux Embarcado)">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    Eletiva: Embarcados Avan√ßados (SoC e Linux Embarcado)
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/insper/Embarcados-Avancados/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Insper/Embarcados-Avancados
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" >
    <label class="md-nav__link" for="nav-2">
      FPGA
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="FPGA" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon"></span>
        FPGA
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Tutorial-FPGA-RTL/" class="md-nav__link">
      Tutorial 1 - FPGA - RTL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Entrega-1/" class="md-nav__link">
      üëÅ Entrega 1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Tutorial-FPGA-NIOS/" class="md-nav__link">
      Tutorial 2 - FPGA - NIOS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Entrega-2/" class="md-nav__link">
      üëÅ Entrega 2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Tutorial-FPGA-NIOS-IP/" class="md-nav__link">
      Tutorial 3 - FPGA - IP
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Entrega-3/" class="md-nav__link">
      üëÅ Entrega 3
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" checked>
    <label class="md-nav__link" for="nav-3">
      HPS
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="HPS" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        HPS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Tutorial-HPS/" class="md-nav__link">
      Vis√£o geral
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Tutorial-HPS-Running/" class="md-nav__link">
      Tutorial 4 - HPS - Linux embarcado
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Tutorial-HPS-BuildSystem/" class="md-nav__link">
      Tutorial 5 - HPS - Infra
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Tutorial-HPS-BlinkLED/" class="md-nav__link">
      Tutorial 6 - HPS - BlinkLED
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../info-HPS-ethernet/" class="md-nav__link">
      Extra: configurando rede
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Entrega-4/" class="md-nav__link">
      üëÅ Entrega 4
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Tutorial-HPS-Kernel/" class="md-nav__link">
      Tutorial 7 - HPS - Compilando o kernel
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Tutorial-HPS-Buildroot/" class="md-nav__link">
      Tutorial 8 - HPS -Buildroot
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Entrega-5/" class="md-nav__link">
      üëÅ Entrega 5
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Device Driver
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Device Driver
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#kernel" class="md-nav__link">
    Kernel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#userspace-vs-kernel-space" class="md-nav__link">
    Userspace vs Kernel Space
  </a>
  
    <nav class="md-nav" aria-label="Userspace vs Kernel Space">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#userspace" class="md-nav__link">
    userspace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kernel-space" class="md-nav__link">
    Kernel Space
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kernel-module-device-driver" class="md-nav__link">
    Kernel Module / Device driver
  </a>
  
    <nav class="md-nav" aria-label="Kernel Module / Device driver">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#device-driver_1" class="md-nav__link">
    Device driver
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#device-tree-dts" class="md-nav__link">
    Device Tree (dts)
  </a>
  
    <nav class="md-nav" aria-label="Device Tree (dts)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#u-boot" class="md-nav__link">
    u-boot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dtb-dts-compilado" class="md-nav__link">
    dtb (dts compilado)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entendendo-o-dts" class="md-nav__link">
    entendendo o dts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Tutorial-HPS-kernel-module/" class="md-nav__link">
      Kernel module
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Tutorial-HPS-kernel-chardriver/" class="md-nav__link">
      Char device driver
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" >
    <label class="md-nav__link" for="nav-4">
      HPS + FPGA
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="HPS + FPGA" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        HPS + FPGA
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Tutorial-HPS-FPGA-BlinkLED/" class="md-nav__link">
      Tutorial - HPS + FPGA - Blink LED
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Tutorial-HPS-FPGA-kernel-char-led-driver/" class="md-nav__link">
      Char LED device driver
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" >
    <label class="md-nav__link" for="nav-5">
      Acelerando
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Acelerando" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Acelerando
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Tutorial-Acelerando-HLS/" class="md-nav__link">
      Tutorial - Acelerando - HLS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" >
    <label class="md-nav__link" for="nav-6">
      Extras
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Extras" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Extras
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Tutorial-HPS-FPGA-VGA/" class="md-nav__link">
      Tutorial - HPS + FPGA - VGA
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Entrega-6/" class="md-nav__link">
      üëÅ Entrega 6
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Entrega-Extra-1/" class="md-nav__link">
      üëÅ Entrega Opcional 1
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7" >
    <label class="md-nav__link" for="nav-7">
      √öteis
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="√öteis" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon"></span>
        √öteis
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../info-FPGA-e-Softwares/" class="md-nav__link">
      Infraestrutura de HW e SWs
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../info-VHDL/" class="md-nav__link">
      VHDL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../info-SDcard/" class="md-nav__link">
      Atualizando o SDCARD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../info-HPS-Serial/" class="md-nav__link">
      Screen
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../info-HPS-ethernet/" class="md-nav__link">
      Ethernet
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8" >
    <label class="md-nav__link" for="nav-8">
      Tutoriais Alunos
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Tutoriais Alunos" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        Tutoriais Alunos
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Projeto-Overview/" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Projeto-Rubrica/" class="md-nav__link">
      Rubrica
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="https://github.com/Insper/Embarcados-Avancados-Template" class="md-nav__link">
      Template markdown
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-4" type="checkbox" id="nav-8-4" >
    <label class="md-nav__link" for="nav-8-4">
      2020
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="2020" data-md-level="2">
      <label class="md-nav__title" for="nav-8-4">
        <span class="md-nav__icon md-icon"></span>
        2020
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../2020/Temas/" class="md-nav__link">
      Temas 20b
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2020/PS3-Linux-Tutorial/" class="md-nav__link">
      PS3 Hack
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2020/Android/" class="md-nav__link">
      Android para Raspbery Pi 3
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8-5" type="checkbox" id="nav-8-5" >
    <label class="md-nav__link" for="nav-8-5">
      2019
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="2019" data-md-level="2">
      <label class="md-nav__title" for="nav-8-5">
        <span class="md-nav__icon md-icon"></span>
        2019
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../2019/Tutoriais/" class="md-nav__link">
      Tutoriais 2019
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2019/Gabriel-TensorFlow/" class="md-nav__link">
      Gabriel Moreira - TensorFlow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2019/Leo-OpenCL/" class="md-nav__link">
      Leonardo Medeiros  - Tutorial OpenCL
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2019/Elisa-Yocto/" class="md-nav__link">
      Elisa Malzoni - Yocto
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2019/Pedro-OpenCV/" class="md-nav__link">
      Pedro de la Pen√£ - Jetson Nano GPU
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2019/Martim-F1/" class="md-nav__link">
      Martim F. Jos√© - FPGA na AWS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2019/Toranja-DevDriver/" class="md-nav__link">
      Bruno Toranja - Linux Device Driver
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#kernel" class="md-nav__link">
    Kernel
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#userspace-vs-kernel-space" class="md-nav__link">
    Userspace vs Kernel Space
  </a>
  
    <nav class="md-nav" aria-label="Userspace vs Kernel Space">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#userspace" class="md-nav__link">
    userspace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#kernel-space" class="md-nav__link">
    Kernel Space
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#kernel-module-device-driver" class="md-nav__link">
    Kernel Module / Device driver
  </a>
  
    <nav class="md-nav" aria-label="Kernel Module / Device driver">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#device-driver_1" class="md-nav__link">
    Device driver
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#device-tree-dts" class="md-nav__link">
    Device Tree (dts)
  </a>
  
    <nav class="md-nav" aria-label="Device Tree (dts)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#u-boot" class="md-nav__link">
    u-boot
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dtb-dts-compilado" class="md-nav__link">
    dtb (dts compilado)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#entendendo-o-dts" class="md-nav__link">
    entendendo o dts
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/Insper/Embarcados-Avancados/edit/master/docs-src/Tutorial-HPS-DeviceDriver1.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="device-driver">Device Driver<a class="headerlink" href="#device-driver" title="Permanent link">&para;</a></h1>
<p>Iremos nesse tutorial desenvolver um device driver para o kernel do linux, esse device ir√° abstrair o controle do LED e o acesso a chave SW do kit de desenvolvimento.</p>
<h2 id="kernel">Kernel<a class="headerlink" href="#kernel" title="Permanent link">&para;</a></h2>
<p>O Linux √© um <a href="https://en.wikipedia.org/wiki/Monolithic_kernel">kernel monolitico</a>, onde todo c√≥digo referente ao sistema operacional acontece no kernel space. </p>
<p><img alt="" src="https://upload.wikimedia.org/wikipedia/commons/thumb/3/3a/Linux_kernel_ubiquity.svg/1920px-Linux_kernel_ubiquity.svg.png" width="500" /></p>
<p>O kernel do Linux √© respons√°vel, dentre outras coisas, por:</p>
<ul>
<li>gerenciar processos e tar√©fas</li>
<li>scheduling</li>
<li>virtualiza√ß√£o, controle de grupos/ usu√°rios</li>
<li>gerenciamento de mem√≥ria/ pagina√ß√£o</li>
<li>comunica√ß√£o inter-processos</li>
<li>entrada/sa√≠da</li>
<li>gerenciamento de arquivos</li>
<li>device drivers</li>
<li>abstra√ß√£o de hardware</li>
</ul>
<p><img alt="" src="https://upload.wikimedia.org/wikipedia/commons/5/5b/Linux_kernel_map.png" width="500" /></p>
<blockquote>
<p>Mapa da arquitetura interna do kernel do linux</p>
</blockquote>
<div class="admonition info">
<p class="admonition-title">Microkernel</p>
<p>O microkernel √© uma alternativa ao kernel monolitico, nessa arquitetura o kernel implementa o m√≠nimo necess√°rio.
<img alt="" src="https://upload.wikimedia.org/wikipedia/commons/thumb/6/67/OS-structure.svg/900px-OS-structure.svg.png" width="300" /></p>
</div>
<div class="admonition info">
<p class="admonition-title">GNU</p>
<p>O kernel do linux faz uso de diversos softwares criados e dispon√≠veis pela comunidade <a href="https://www.gnu.org">GNU</a> (como o gcc, gdb, make, e <a href="https://www.gnu.org/software/software.html">muitos outros</a> por isso √© muitas vezes conhecido como GNU/Linux.</p>
<p><img alt="" src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c9/Gnulinux.svg/260px-Gnulinux.svg.png" width="100" /></p>
</div>
<h2 id="userspace-vs-kernel-space">Userspace vs Kernel Space<a class="headerlink" href="#userspace-vs-kernel-space" title="Permanent link">&para;</a></h2>
<blockquote>
<p>Grande parte dessa sec√ß√£o foi traduzida de <a href="https://www.ctrlinux.com/blog/?p=40">https://www.ctrlinux.com/blog/?p=40</a></p>
</blockquote>
<p>Userspace √© uma regi√£o de mem√≥ria virtual onde todos os programas do usu√°rio s√£o executados. Os programas que fazem parte do userspace s√£o executados em um modo de opera√ß√£o da CPU chamado de <em>unprivileged</em>, onde nem todas instru√ß√µes e registradores est√£o dispon√≠veis. </p>
<p>O ARM suporta um total de 7 modos de execu√ß√£o, sendo que apenas o usermode √© n√£o privilegiado:</p>
<ol>
<li>User mode ‚Äì All user level applications run in this mode.</li>
<li>FIQ Fast Interrupt Mode ‚Äì Used to handle interrupts classified as ‚Äúfast‚Äù, get in and get out type of interrupts.</li>
<li>IRQ Mode ‚Äì Used to handle device interrupts and non FIQ interrupts.</li>
<li>Supervisor mode (default CPU boot mode). Used by the OS and software interrupts (SWIs).</li>
<li>Abort ‚Äì Used to handle violations caused by erroneous memory accesses</li>
<li>Undefined ‚Äì Used to handle undefined instructions</li>
<li>System ‚Äì A privileged mode with the same register set as usermode, used to run exceptions handlers.</li>
</ol>
<blockquote>
<p>Material retirado de: <a href="https://www.ctrlinux.com/blog/?p=40">https://www.ctrlinux.com/blog/?p=40</a></p>
</blockquote>
<h3 id="userspace">userspace<a class="headerlink" href="#userspace" title="Permanent link">&para;</a></h3>
<p>Para entender melhor o userspace, vamos imaginar o que acontece quando um programa tenta acessar uma regi√£o de mem√≥ria que pertence a ao kernel (modo privilegiado).</p>
<p>Quando criamos um ponteiro e acessamos uma mem√≥ria, esse comando √© traduzindo para uma instru√ß√£o do tipo LOAD em assembly. A instru√ß√£o LOAD entra no pipeline da CPU e no est√°gio de execu√ß√£o a CPU passa o endere√ßo da instru√ß√£o para o hardware respons√°vel por gerenciar a mem√≥ria: Memory Management Unit (MMU). O MMU traduz o endere√ßo de mem√≥ria virtual para o endere√ßo f√≠sico (pagina de mem√≥ria), nesse ponto o MMU verifica o modo de execu√ß√£o atual da CPU e se a regi√£o de mem√≥ria pode ser acessada pelo modo atual. No nosso caso a CPU ir√° mudar o modo do processador para <em>Abort</em> e tratar o acesso ao endere√ßo de mem√≥ria n√£o autorizado, causando o encerramento do programa com <code>seg fault</code>. </p>
<p>Programas no userspace se comunicam com o kernel via chamadas de sistema<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup> (<em>system calls</em>), essas chamadas viram interrup√ß√µes de software que ser√£o processadas pelo kernel.</p>
<h3 id="kernel-space">Kernel Space<a class="headerlink" href="#kernel-space" title="Permanent link">&para;</a></h3>
<p>As vantagens de trabalhar com o kernel space s√£o: Poder manipular diretamente os perif√©ricos do hardware, poder tratar interrup√ß√µes de hw. Com grandes poderes v√™m grandes responsabilidades, erros nesse  modo podem causar kernel panic e travar todo o sistema.</p>
<h2 id="kernel-module-device-driver">Kernel Module / Device driver<a class="headerlink" href="#kernel-module-device-driver" title="Permanent link">&para;</a></h2>
<p><a href="https://lwn.net/Kernel/LDD3/">https://lwn.net/Kernel/LDD3/</a></p>
<p>Um m√≥dulo do kernel √© um c√≥digo compilado que pode ser lincado com o kernel em tempo de execu√ß√£o (como alterar a asa de um avi√£o em movimento), um m√≥dulo pode ser um driver de dispositivo, mas n√£o necessariamente.</p>
<h3 id="device-driver_1">Device driver<a class="headerlink" href="#device-driver_1" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p class="admonition-title">Refer√™ncias:</p>
<ul>
<li><a href="https://linux-kernel-labs.github.io/refs/heads/master/">https://linux-kernel-labs.github.io/refs/heads/master/</a></li>
<li><a href="https://tldp.org/LDP/tlk/dd/drivers.html">https://tldp.org/LDP/tlk/dd/drivers.html</a></li>
<li><a href="https://www.kernel.org/doc/html/v4.11/driver-api/index.html">https://www.kernel.org/doc/html/v4.11/driver-api/index.html</a></li>
<li><code>linux/Documentation/driver-model/*</code></li>
</ul>
</div>
<p>Drivers de dispositivos s√£o respons√°veis por implementar a parte de baixo n√≠vel de configura√ß√£o, comunica√ß√£o e gerenciamento do hardware (perif√©ricos, mem√≥ria, CPU). No reposit√≥rio do kernel do Linux, os drivers est√£o localizados em: <code>linux/drivers/</code> e est√£o organizados por categoria:</p>
<div class="highlight"><pre><span></span><code>accessibility  dca         ide         mfd              pnp         spmi
acpi           devfreq     idle        misc             power       ssb
amba           dio         iio         mmc              powercap    staging
android        dma         infiniband  modules.builtin  pps         target
ata            dma-buf     input       mtd              ps3         tc
atm            edac        iommu       net              ptp         thermal
auxdisplay     eisa        ipack       nfc              pwm         thunderbolt
base           extcon      irqchip     ntb              rapidio     tty
bcma           firewire    isdn        nubus            ras         uio
block          firmware    Kconfig     nvdimm           regulator   usb
bluetooth      fmc         leds        nvme             remoteproc  uwb
built-in.a     fpga        lguest      nvmem            reset       vfio
built-in.o     gpio        lightnvm    of               rpmsg       vhost
bus            gpu         macintosh   oprofile         rtc         video
cdrom          hid         mailbox     parisc           s390        virt
char           hsi         Makefile    parport          sbus        virtio
clk            hv          mcb         pci              scsi        vlynq
clocksource    hwmon       md          pcmcia           sfi         vme
connector      hwspinlock  media       perf             sh          w1
cpufreq        hwtracing   memory      phy              sn          watchdog
cpuidle        i2c         memstick    pinctrl          soc         xen
crypto         i3c         message     platform         spi         zorro
</code></pre></div>
<p>No linux os drivers podem ser desenvolvidos/classificados em basicamente <a href="https://tldp.org/LDP/tlk/dd/drivers.html">tr√™s tipos</a>: <code>char module</code>, <code>block module</code>, <code>network module</code>.</p>
<ul>
<li>
<p><strong>character device</strong>: √â usado no caso que o driver pode ser acessado com um <em>strem</em> de bytes (como um arquivo). Deve implementar no m√≠nimo as seguintes chamadas de sistema: <code>open/close/read/write</code>. O <code>/dev/console</code> e <code>/dev/tty</code> s√£o exemplos desse tipo de device. Uma diferen√ßa entre um arquivo e um <code>char dev</code> √© que no arquivo voc√™ pode mover o ponteiro para frente e para traz, mas nesse tipo de device n√£o, voc√™ s√≥ pode ir para frente.</p>
</li>
<li>
<p><strong>block device</strong>: Usado para implementar acesso a disco f√≠sico, esse tipo de driver opera com blocos de bytes (normalmente 512 bytes).</p>
</li>
<li>
<p><strong>network device</strong>: Utilizado para implementar uma interface de rede (como o <code>loopback/ wlan0/ ...</code>). Essa interface √© capaz de receber e enviar pacotes de dados, controlado pelo sistema de rede do kernel.</p>
</li>
</ul>
<h2 id="device-tree-dts">Device Tree (dts)<a class="headerlink" href="#device-tree-dts" title="Permanent link">&para;</a></h2>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>Isso acontece apenas em sistemas embarcados. Para saber como o Kernel do linux sabe quais s√£o os dispositivos dispon√≠veis acesse:  <a href="https://unix.stackexchange.com/questions/399619/why-do-embedded-systems-need-device-tree-while-pcs-dont">https://unix.stackexchange.com/questions/399619/why-do-embedded-systems-need-device-tree-while-pcs-dont</a></p>
</div>
<p>Como o kernel do linux sabe quais s√£o os dispositivos e drivers associados a eles? Um arquivo de configura√ß√£o chamado de device tree √© passado pelo boot para o kernel do Linux indicando os perif√©ricos, e quais s√£o os drivers associados a eles.</p>
<h3 id="u-boot">u-boot<a class="headerlink" href="#u-boot" title="Permanent link">&para;</a></h3>
<p>A programa√ß√£o da FPGA √© realizada pelo u-boot, antes da inicializa√ß√£o do
Kernel do Linux.  No nosso caso, o u-boot foi pr√© configurado para ler o arquivo
<code>soc_system.rbf</code> que est√° na parti√ß√£o do SDCARD junto com o kernel (<code>zImage</code>).</p>
<div class="admonition note">
<p class="admonition-title">Explica√ß√£o do processo de boot - at√© 1:50 minutos</p>
<p><iframe width="560" height="315" src="https://www.youtube.com/embed/vS7pvefsbRM" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p>
</div>
<p>O u-boot antes de inicializar o kernel do Linux, busca esse arquivo na parti√ß√£o do SDCARD, o extra√≠ e programa <a href="https://github.com/u-boot/u-boot/blob/94905e1db8d8d42c4f39f14dbee2f9788390db5e/drivers/fpga/socfpga.c">"magicamente"</a> a FPGA. Nessa mesma parti√ß√£o temos mais dois arquivos: <code>u-boot.scr</code> e <code>socfpga.dtb</code>. O primeiro √© um script de inicializa√ß√£o do boot na qual o u-boot l√™ para saber quais passos ele deve executar (se precisa carregar a fpga, onde est√° o kernel, ..., s√£o os passos de inicializa√ß√£o), j√° o <code>socfpga.dtb</code> √© o <strong>device tree do Linux</strong>, o dtb √© um bin√°rio, que foi criado a partir de outro arquivo, o <code>.dts</code>, e ele cont√©m informa√ß√µes sobre o hardware que √© passado para o kernel no momento de inicializa√ß√£o.</p>
<div class="admonition note">
<p class="admonition-title">Device Tree for Dummies! - Thomas Petazzoni, Free Electrons</p>
<p><iframe width="560" height="315" src="https://www.youtube.com/embed/m_NyYEBxfn8" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe></p>
</div>
<h3 id="dtb-dts-compilado"><code>dtb</code> (dts compilado)<a class="headerlink" href="#dtb-dts-compilado" title="Permanent link">&para;</a></h3>
<p>O <code>dtb</code> √© utilizado como ferramenta para indicar ao kernel quais s√£o as
configura√ß√µes de hardware dispon√≠veis, voc√™ n√£o precisa recompilar o kernel caso
o endere√ßo de mem√≥ria de algum perif√©rico muder, basta informar no <code>dts</code>. Essa
ferramenta √© muito importante para sistemas embarcados, na qual, cada hardware
possui sua especificidade.</p>
<p>O <code>dtb</code> √© gerado a partir de arquivo texto no formato <code>dts</code> que √© ent√£o gerado
pelas informa√ß√µes  de hardware extra√≠da do <strong>Platform Designer</strong> que s√£o salvas
no arquivo: <code>.sopcinfo</code>, o mesmo arquivo que √© utilizado pelo Eclipse-NIOS para
gerar o BSP nos tutoriais passados. O BSP no Linux √© chamado de <code>dts</code>  e
possui um formato padr√£o que deve ser seguido!</p>
<h3 id="entendendo-o-dts">entendendo o dts<a class="headerlink" href="#entendendo-o-dts" title="Permanent link">&para;</a></h3>
<p><img alt="" src="../figs/Tutorial-HLS-FPGA-BlinkLED-devicetree.png" /></p>
<ul>
<li>ref: <a href="https://developer.toradex.com/device-tree-customization">https://developer.toradex.com/device-tree-customization</a></li>
</ul>
<p>O come√ßo do nosso <code>.dts</code> tem a defini√ß√£o das CPUs que est√£o
dispon√≠veis no CHIP:</p>
<div class="highlight"><pre><span></span><code>    <span class="nf">cpus</span><span class="cm"> </span><span class="p">{</span>
        <span class="kr">#address-cells</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">1</span><span class="o">&gt;</span><span class="p">;</span>
        <span class="kr">#size-cells</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">0</span><span class="o">&gt;</span><span class="p">;</span>
        <span class="n">enable-method</span> <span class="o">=</span> <span class="s">&quot;altr,socfpga-smp&quot;</span><span class="p">;</span> <span class="cm">/* appended from boardinfo */</span>

        <span class="nl">hps_0_arm_a9_0</span><span class="p">:</span> <span class="na">cpu</span><span class="err">@</span><span class="nf">0x0</span><span class="cm"> </span><span class="p">{</span>
            <span class="kr">device_type</span> <span class="o">=</span> <span class="s">&quot;cpu&quot;</span><span class="p">;</span>
            <span class="kr">compatible</span> <span class="o">=</span> <span class="s">&quot;arm,cortex-a9-16.1&quot;</span><span class="p">,</span> <span class="s">&quot;arm,cortex-a9&quot;</span><span class="p">;</span>
            <span class="kr">reg</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mh">0x00000000</span><span class="o">&gt;</span><span class="p">;</span>
            <span class="n">next-level-cache</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="na">hps_0_L2</span><span class="o">&gt;</span><span class="p">;</span> <span class="cm">/* appended from boardinfo */</span>
        <span class="p">};</span> <span class="c1">//end cpu@0x0 (hps_0_arm_a9_0)</span>

        <span class="nl">hps_0_arm_a9_1</span><span class="p">:</span> <span class="na">cpu</span><span class="err">@</span><span class="nf">0x1</span><span class="cm"> </span><span class="p">{</span>
            <span class="kr">device_type</span> <span class="o">=</span> <span class="s">&quot;cpu&quot;</span><span class="p">;</span>
            <span class="kr">compatible</span> <span class="o">=</span> <span class="s">&quot;arm,cortex-a9-16.1&quot;</span><span class="p">,</span> <span class="s">&quot;arm,cortex-a9&quot;</span><span class="p">;</span>
            <span class="kr">reg</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mh">0x00000001</span><span class="o">&gt;</span><span class="p">;</span>
            <span class="n">next-level-cache</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="na">hps_0_L2</span><span class="o">&gt;</span><span class="p">;</span> <span class="cm">/* appended from boardinfo */</span>
        <span class="p">};</span> <span class="c1">//end cpu@0x1 (hps_0_arm_a9_1)</span>
    <span class="p">};</span> <span class="c1">//end cpus</span>
</code></pre></div>
<p>Vamos ver em mais detalhes o <code>hps_0_uart0</code> do nosso <code>dts</code>:</p>
<div class="highlight"><pre><span></span><code>        <span class="nl">hps_0_uart0</span><span class="p">:</span> <span class="na">serial</span><span class="err">@</span><span class="mh">0xffc02000</span> <span class="p">{</span>
            <span class="kr">compatible</span> <span class="o">=</span> <span class="s">&quot;snps,dw-apb-uart-16.1&quot;</span><span class="p">,</span> <span class="s">&quot;snps,dw-apb-uart&quot;</span><span class="p">;</span>
            <span class="kr">reg</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mh">0xffc02000</span> <span class="mh">0x00000100</span><span class="o">&gt;</span><span class="p">;</span>
            <span class="n">interrupt-parent</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="na">hps_0_arm_gic_0</span><span class="o">&gt;</span><span class="p">;</span>
            <span class="n">interrupts</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">0</span> <span class="mi">162</span> <span class="mi">4</span><span class="o">&gt;</span><span class="p">;</span>
            <span class="n">clocks</span> <span class="o">=</span> <span class="o">&lt;&amp;</span><span class="na">l4_sp_clk</span><span class="o">&gt;</span><span class="p">;</span>
            <span class="kr">reg</span><span class="o">-</span><span class="n">io-width</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">4</span><span class="o">&gt;</span><span class="p">;</span> <span class="cm">/* embeddedsw.dts.params.reg-io-width type NUMBER */</span>
            <span class="kr">reg</span><span class="o">-</span><span class="n">shift</span> <span class="o">=</span> <span class="o">&lt;</span><span class="mi">2</span><span class="o">&gt;</span><span class="p">;</span>    <span class="cm">/* embeddedsw.dts.params.reg-shift type NUMBER */</span>
            <span class="kr">status</span> <span class="o">=</span> <span class="s">&quot;okay&quot;</span><span class="p">;</span>    <span class="cm">/* embeddedsw.dts.params.status type STRING */</span>
        <span class="p">};</span> <span class="c1">//end serial@0xffc02000 (hps_0_uart0)</span>
<span class="p">};</span> <span class="c1">//end serial@0x100020000 (jtag_uart)</span>
</code></pre></div>
<p>Ele indica que no nosso hardware, temos um componente serial no endere√ßo
<code>0xffc02000</code> que √© compat√≠vel com os drivers: <code>snps,dw-apb-uart-16.1</code> e.ou
<code>snps,dw-apb-uart</code>, que √© implementado no Driver: 8250 no kernel do Linux:
<a href="https://github.com/torvalds/linux/blob/master/drivers/tty/serial/8250/8250_dw.c">https://github.com/torvalds/linux/blob/master/drivers/tty/serial/8250/8250_dw.c</a>.
E esse driver est√° configurado como ativo no nosso kernel:</p>
<p><img alt="" src="../figs/Tutorial-HLS-FPGA-BlinkLED-uart.png" width="400" /></p>
<p>E √© por conta disso que conseguimos acessar o kit com USB (screen).</p>
<details class="note"><summary>Par√¢metro CONFIG_SERIAL_8250_CONSOLE</summary><div class="highlight"><pre><span></span><code> CONFIG_SERIAL_8250_CONSOLE:                                                 ‚îÇ  
  ‚îÇ                                                                             ‚îÇ  
  ‚îÇ If you say Y here, it will be possible to use a serial port as the          ‚îÇ  
  ‚îÇ system console (the system console is the device which receives all         ‚îÇ  
  ‚îÇ kernel messages and warnings and which allows logins in single user         ‚îÇ  
  ‚îÇ mode). This could be useful if some terminal or printer is connected        ‚îÇ  
  ‚îÇ to that serial port.                                                        ‚îÇ  
  ‚îÇ                                                                             ‚îÇ  
  ‚îÇ Even if you say Y here, the currently visible virtual console               ‚îÇ  
  ‚îÇ (/dev/tty0) will still be used as the system console by default, but        ‚îÇ  
  ‚îÇ you can alter that using a kernel command line option such as               ‚îÇ  
  ‚îÇ &quot;console=ttyS1&quot;. (Try &quot;man bootparam&quot; or see the documentation of           ‚îÇ  
  ‚îÇ your boot loader (grub or lilo or loadlin) about how to pass options        ‚îÇ  
  ‚îÇ to the kernel at boot time.)                                                ‚îÇ  
  ‚îÇ                                                                             ‚îÇ  
  ‚îÇ If you don&#39;t have a VGA card installed and you say Y here, the              ‚îÇ  
  ‚îÇ kernel will automatically use the first serial line, /dev/ttyS0, as         ‚îÇ  
  ‚îÇ system console.                                                             ‚îÇ  
  ‚îÇ                                                                             ‚îÇ  
  ‚îÇ You can set that using a kernel command line option such as                 ‚îÇ  
  ‚îÇ &quot;console=uart8250,io,0x3f8,9600n8&quot;                                          ‚îÇ  
  ‚îÇ &quot;console=uart8250,mmio,0xff5e0000,115200n8&quot;.                                ‚îÇ  
  ‚îÇ and it will switch to normal serial console when the corresponding          ‚îÇ  
  ‚îÇ port is ready.                                                              ‚îÇ  
  ‚îÇ &quot;earlycon=uart8250,io,0x3f8,9600n8&quot;                                         ‚îÇ  
  ‚îÇ &quot;earlycon=uart8250,mmio,0xff5e0000,115200n8&quot;.                               ‚îÇ  
  ‚îÇ it will not only setup early console.                                       ‚îÇ  
  ‚îÇ                                                                             ‚îÇ  
  ‚îÇ If unsure, say N.                                                           ‚îÇ  
  ‚îÇ                                                                             ‚îÇ  
  ‚îÇ Symbol: SERIAL_8250_CONSOLE [=y]                                            ‚îÇ  
  ‚îÇ Type  : boolean                                                             ‚îÇ  
  ‚îÇ Prompt: Console on 8250/16550 and compatible serial port              
  ‚îÇ   Location:                                                                 ‚îÇ  
  ‚îÇ     -&gt; Device Drivers                                                       ‚îÇ  
  ‚îÇ       -&gt; Character devices                                                  ‚îÇ  
  ‚îÇ         -&gt; Serial drivers                                                   ‚îÇ  
  ‚îÇ           -&gt; 8250/16550 and compatible serial support (SERIAL_8250 [=y])    ‚îÇ  
  ‚îÇ   Defined at drivers/tty/serial/8250/Kconfig:60                             ‚îÇ  
  ‚îÇ   Depends on: TTY [=y] &amp;&amp; HAS_IOMEM [=y] &amp;&amp; SERIAL_8250 [=y]=y              ‚îÇ  
  ‚îÇ   Selects: SERIAL_CORE_CONSOLE [=y] &amp;&amp; SERIAL_EARLYCON [=y]                 ‚îÇ  
  ‚îÇ                                                                        
</code></pre></div>
</details>
<div class="admonition note">
<p class="admonition-title">Para mais informa√ß√µes sobre o <code>dts</code>:</p>
<ul>
<li><a href="https://elinux.org/Device_Tree_Usage">https://elinux.org/Device_Tree_Usage</a></li>
<li><a href="https://elinux.org/Device_Tree_Reference">https://elinux.org/Device_Tree_Reference</a></li>
<li><a href="https://developer.toradex.com/device-tree-customization#Device_Tree_Anatomy">https://developer.toradex.com/device-tree-customization#Device_Tree_Anatomy</a></li>
<li><a href="https://bootlin.com/pub/conferences/2014/elc/petazzoni-device-tree-dummies/petazzoni-device-tree-dummies.pdf">https://bootlin.com/pub/conferences/2014/elc/petazzoni-device-tree-dummies/petazzoni-device-tree-dummies.pdf</a></li>
</ul>
</div>
<div class="footnote">
<hr />
<ol>
<li id="fn:1">
<p><a href="http://www.linux.it/~rubini/docs/ksys/">http://www.linux.it/~rubini/docs/ksys/</a>&#160;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">&#8617;</a></p>
</li>
</ol>
</div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../Entrega-5/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                üëÅ Entrega 5
              </div>
            </div>
          </a>
        
        
          <a href="../Tutorial-HPS-kernel-module/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Kernel module
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 / Prof. Rafael Corsi / rafael.corsi@insper.edu.br
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.0ac82a11.min.js"></script>
      <script src="../assets/javascripts/bundle.f81dfb4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: ['instant', 'navigation.expand', {'tabs': True}],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
        <script src="../js/dom-confetti.js"></script>
      
        <script src="../js/progress.js"></script>
      
    
  </body>
</html>